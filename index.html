<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Publicidade TV</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  overflow: hidden;
}

#slide {
  width: 100vw;
  height: 100vh;
  object-fit: contain;
  transition: opacity 0.8s ease-in-out;
}

#relogio {
  position: absolute;
  top: 20px;
  right: 30px;
  color: white;
  font-size: 42px;
  font-family: Arial, sans-serif;
}
</style>
</head>

<body>
<div id="slide"></div>
<div id="relogio"></div>

<script>
let imagens = [];
let index = 0;
let tempo = 8000;
let timerSlides = null;

async function carregarLista() {
  const res = await fetch("lista.json?cache=" + Date.now());
  const data = await res.json();

  if (JSON.stringify(imagens) !== JSON.stringify(data.imagens) || tempo !== data.tempo) {
    imagens = data.imagens;
    tempo = data.tempo;
    index = 0;
    iniciarSlides();
  }
}

function mostrarSlide() {
  if (!imagens.length) return;

  const container = document.getElementById("slide");
  container.innerHTML = "";

  const atual = imagens[index];
  index = (index + 1) % imagens.length;

  // VIDEO
  if (atual.toLowerCase().endsWith(".mp4")) {
    const video = document.createElement("video");
    video.src = atual;
    video.autoplay = true;
    video.muted = true;
    video.playsInline = true;
    video.onended = mostrarSlide;
    container.appendChild(video);
  } 
  // IMAGEM
  else {
    const img = document.createElement("img");
    img.src = atual;
    container.appendChild(img);
    setTimeout(mostrarSlide, tempo);
  }
}

function iniciarSlides() {
  clearTimeout(timerSlides);
  mostrarSlide();
}

/* RELÃ“GIO */
setInterval(() => {
  const d = new Date();
  document.getElementById("relogio").innerText =
    d.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit" });
}, 1000);

/* INICIALIZA */
carregarLista();
setInterval(carregarLista, 60000);
</script>



async function iniciar() {
  await carregarLista();
  mostrarSlide();
  setInterval(mostrarSlide, tempo);
}

iniciar();
</script>
</body>
</html>
