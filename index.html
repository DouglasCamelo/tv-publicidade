<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Publicidade TV</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  overflow: hidden;
}

#slide {
  width: 100vw;
  height: 100vh;
  object-fit: contain;
  transition: opacity 0.8s ease-in-out;
}

#relogio {
  position: absolute;
  top: 20px;
  right: 30px;
  color: white;
  font-size: 42px;
  font-family: Arial, sans-serif;
}
</style>
</head>

<body>
<img id="slide">
<div id="relogio"></div>

<script>
let imagens = [];
let index = 0;
let tempo = 8000;
let timerSlides = null;

async function carregarLista() {
  try {
    const res = await fetch("lista.json?cache=" + Date.now());
    const data = await res.json();

    // Só atualiza se realmente mudou
    if (JSON.stringify(imagens) !== JSON.stringify(data.imagens) || tempo !== data.tempo) {
      imagens = data.imagens;
      tempo = data.tempo;
      index = 0;
      iniciarSlides();
    }
  } catch (e) {
    console.log("Erro ao carregar lista", e);
  }
}

function mostrarSlide() {
  if (!imagens.length) return;

  const slide = document.getElementById("slide");
  slide.style.opacity = 0;

  setTimeout(() => {
    slide.src = imagens[index];
    slide.style.opacity = 1;
    index = (index + 1) % imagens.length;
  }, 400);
}

function iniciarSlides() {
  if (timerSlides) clearInterval(timerSlides);
  mostrarSlide();
  timerSlides = setInterval(mostrarSlide, tempo);
}

/* RELÓGIO */
setInterval(() => {
  const d = new Date();
  document.getElementById("relogio").innerText =
    d.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit" });
}, 1000);

/* INICIALIZA */
carregarLista();
setInterval(carregarLista, 60000); // verifica atualizações a cada 1 min
</script>


async function iniciar() {
  await carregarLista();
  mostrarSlide();
  setInterval(mostrarSlide, tempo);
}

iniciar();
</script>
</body>
</html>
